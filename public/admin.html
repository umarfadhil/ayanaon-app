<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Pin | AyaNaon?</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="auth.css">
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <main class="admin-page">
        <header class="admin-header">
            <div class="admin-title-block">
                <p class="eyebrow">Admin Page</p>
                <h1>Website Management Dashboard</h1>
                <p class="subhead">Manage Pins, Metrics, and Maintenance</p>
            </div>
            <div class="admin-actions">
                <a class="ghost-btn" href="index.html">See Maps</a>
                <button id="admin-logout-btn" class="ghost-btn ghost-btn--danger">Logout</button>
            </div>
        </header>
        <div class="admin-tabs" role="tablist" aria-label="Admin Navigation">
            <button class="admin-tab admin-tab--active" data-tab="pins" role="tab" aria-selected="true">Manage Pins</button>
            <button class="admin-tab" data-tab="users" role="tab" aria-selected="false" data-admin-only="true">Manage Users</button>
            <button class="admin-tab" data-tab="metrics" role="tab" aria-selected="false" data-admin-only="true">Business Metrics</button>
            <button class="admin-tab" data-tab="features" role="tab" aria-selected="false" data-admin-only="true">Features</button>
        </div>

        <section id="admin-pin-content" class="admin-tab-content">

        <section class="admin-summary">
            <div class="summary-card">
                <div class="summary-label">Total Active Pins</div>
                <div class="summary-value" id="pin-count">-</div>
                <button id="refresh-pins-btn" class="chip-btn" type="button">Refresh data</button>
                <div class="summary-meta" id="pin-count-subtext">Loading pin count...</div>
            </div>
            <div class="summary-card admin-user-card">
                <div class="summary-label">Logged in as</div>
                <div class="summary-value" id="admin-name">Admin</div>
                <div class="summary-meta" id="admin-username"></div>
            </div>
            <div class="summary-card maintenance-card" data-admin-only="true">
                <div class="maintenance-row">
                    <div>
                        <div class="summary-label">Website Maintenance</div>
                        <div class="summary-value maintenance-status" id="maintenance-status-label">Normal</div>
                        <div class="summary-meta" id="maintenance-meta">Visitors see the site as usual.</div>
                    </div>
                    <label class="maintenance-switch" aria-label="Toggle maintenance">
                        <input type="checkbox" id="maintenance-toggle">
                        <span class="maintenance-slider"></span>
                    </label>
                </div>
                <label class="maintenance-message-label" for="maintenance-message">Message for visitors</label>
                <textarea id="maintenance-message" rows="2" placeholder="Example: Site under maintenance until 14:00"></textarea>
                <div class="maintenance-actions">
                    <button type="button" id="maintenance-save-btn" class="chip-btn">Save</button>
                    <span class="maintenance-hint">Changes are immediately visible on the main page.</span>
                </div>
            </div>
        </section>

        <div id="admin-message" class="admin-message" role="status" aria-live="polite"></div>

        <section class="admin-grid">
            <aside class="pin-list-panel">
                <div class="panel-header">
                    <div>
                        <h2>Pin List</h2>
                    </div>
                </div>
                <div class="pin-filters" aria-label="Filter pin list">
                    <div class="pin-filter pin-filter--category">
                        <select id="filter-category" aria-label="Category">
                            <option value="">All categories</option>
                        </select>
                    </div>
                    <div class="pin-filter pin-filter-row" role="group" aria-label="Filter Link">
                        <div class="pin-filter-label">Link</div>
                        <div class="pin-filter-options">
                            <label class="pill-radio">
                                <input type="radio" name="filter-link" value="any" checked>
                                <span class="radio-shape"></span>
                                <span class="radio-label">Any</span>
                            </label>
                            <label class="pill-radio">
                                <input type="radio" name="filter-link" value="with">
                                <span class="radio-shape"></span>
                                <span class="radio-label">Filled</span>
                            </label>
                            <label class="pill-radio">
                                <input type="radio" name="filter-link" value="without">
                                <span class="radio-shape"></span>
                                <span class="radio-label">Empty</span>
                            </label>
                        </div>
                    </div>
                    <div class="pin-filter pin-filter-row" role="group" aria-label="Filter Start Date">
                        <div class="pin-filter-label">Start Date</div>
                        <div class="pin-filter-options">
                            <label class="pill-radio">
                                <input type="radio" name="filter-start" value="any" checked>
                                <span class="radio-shape"></span>
                                <span class="radio-label">Any</span>
                            </label>
                            <label class="pill-radio">
                                <input type="radio" name="filter-start" value="filled">
                                <span class="radio-shape"></span>
                                <span class="radio-label">Filled</span>
                            </label>
                            <label class="pill-radio">
                                <input type="radio" name="filter-start" value="empty">
                                <span class="radio-shape"></span>
                                <span class="radio-label">Empty</span>
                            </label>
                        </div>
                    </div>
                    <div class="pin-filter pin-filter-row" role="group" aria-label="Filter End Date">
                        <div class="pin-filter-label">End Date</div>
                        <div class="pin-filter-options">
                            <label class="pill-radio">
                                <input type="radio" name="filter-end" value="any" checked>
                                <span class="radio-shape"></span>
                                <span class="radio-label">Any</span>
                            </label>
                            <label class="pill-radio">
                                <input type="radio" name="filter-end" value="filled">
                                <span class="radio-shape"></span>
                                <span class="radio-label">Filled</span>
                            </label>
                            <label class="pill-radio">
                                <input type="radio" name="filter-end" value="empty">
                                <span class="radio-shape"></span>
                                <span class="radio-label">Empty</span>
                            </label>
                        </div>
                    </div>
                    <div class="pin-filter pin-filter-row" role="group" aria-label="Filter Photo">
                        <div class="pin-filter-label">Photo</div>
                        <div class="pin-filter-options">
                            <label class="pill-radio">
                                <input type="radio" name="filter-photo" value="any" checked>
                                <span class="radio-shape"></span>
                                <span class="radio-label">Any</span>
                            </label>
                            <label class="pill-radio">
                                <input type="radio" name="filter-photo" value="with">
                                <span class="radio-shape"></span>
                                <span class="radio-label">Filled</span>
                            </label>
                            <label class="pill-radio">
                                <input type="radio" name="filter-photo" value="without">
                                <span class="radio-shape"></span>
                                <span class="radio-label">Empty</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="pin-search-row">
                    <input type="search" id="pin-search" placeholder="Search title or category" aria-label="Search pins">
                    <button type="button" class="search-btn" id="pin-search-btn">Search</button>
                </div>
                <ul id="pin-list" class="pin-list" aria-label="List of pins"></ul>
            </aside>

            <section class="pin-editor">
                <div class="panel-header">
                    <div>
                        <h2 id="editor-title">Pin Details</h2>
                    </div>
                </div>
                <form id="pin-edit-form" class="pin-form" novalidate>
                    <div class="form-row">
                        <label for="pin-title">Title</label>
                        <input type="text" id="pin-title" name="title" required placeholder="Pin title">
                    </div>
                    <div class="form-row">
                        <label for="pin-description">Description</label>
                        <textarea id="pin-description" name="description" required rows="3" placeholder="Short description"></textarea>
                    </div>
                    <div class="form-grid">
                        <div class="form-row">
                            <label for="pin-category">Category</label>
                            <input type="text" id="pin-category" name="category" required placeholder="Category">
                        </div>
                        <div class="form-row">
                            <label for="pin-link">Link (optional)</label>
                            <input type="url" id="pin-link" name="link" placeholder="https://">
                        </div>
                    </div>
                    <div class="form-row">
                        <label for="pin-lifetime">Lifetime</label>
                        <select id="pin-lifetime">
                            <option value="">Leave as is</option>
                            <option value="today">Only today</option>
                            <option value="date">Select date</option>
                        </select>
                    </div>
                    <div class="form-grid">
                        <div class="form-row">
                            <label for="pin-lifetime-start">Start Date</label>
                            <input type="text" id="pin-lifetime-start" placeholder="dd/mm/yyyy">
                        </div>
                        <div class="form-row">
                            <label for="pin-lifetime-end">End Date</label>
                            <input type="text" id="pin-lifetime-end" placeholder="dd/mm/yyyy">
                        </div>
                    </div>
                    <div class="form-row coordinate-row">
                        <label>Coordinates</label>
                        <p class="image-hint">Fill in manually or use the mini map to select a location.</p>
                        <div class="form-grid">
                            <input type="text" id="pin-lat" placeholder="Lat">
                            <input type="text" id="pin-lng" placeholder="Lng">
                        </div>
                        <div class="mini-map-search">
                            <input type="text" id="mini-map-search-input" placeholder="Search address or place">
                            <button type="button" id="mini-map-search-btn" class="ghost-btn chip-btn">Search</button>
                        </div>
                        <div id="admin-mini-map" class="mini-map" aria-label="Mini map for selecting location"></div>
                    </div>
                    <div class="form-row">
                        <label>Pin Photos</label>
                        <div class="image-hint" id="image-hint">Maximum 3 photos, 4MB per photo.</div>
                        <div id="existing-images" class="image-list" aria-live="polite"></div>
                        <div id="new-images" class="image-list" aria-live="polite"></div>
                        <div class="upload-actions-row">
                            <div class="upload-row">
                                <label class="upload-btn">
                                    <input type="file" id="pin-image-input" accept="image/*" multiple>
                                    <span>Add Photos</span>
                                </label>
                                <span class="upload-remaining" id="photo-remaining"></span>
                            </div>
                            <div class="form-actions">
                                <button type="button" id="delete-pin-btn" class="ghost-btn ghost-btn--danger">Delete Pin</button>
                                <button type="submit" class="primary-btn" id="save-pin-btn">Save Changes</button>
                            </div>
                        </div>
                    </div>
                </form>
            </section>
        </section>
        </section>

        <div id="admin-users-pane" class="admin-tab-content hidden" data-admin-only="true">
            <section class="admin-users">
                <div class="panel-header">
                    <div>
                        <h2>User Management</h2>
                        <p class="panel-sub">Kelola status warga terdaftar.</p>
                    </div>
                    <div class="panel-actions">
                        <button type="button" id="users-refresh-btn" class="ghost-btn chip-btn">Refresh</button>
                    </div>
                </div>
                <div id="admin-users-message" class="admin-message" role="status" aria-live="polite"></div>
                <div class="users-table" role="table" aria-label="Daftar warga terdaftar">
                    <div class="users-table__row users-table__header" role="row">
                        <div role="columnheader">Display Name</div>
                        <div role="columnheader">Username</div>
                        <div role="columnheader">Last Login</div>
                        <div role="columnheader">Status</div>
                        <div role="columnheader">Action</div>
                    </div>
                    <div id="users-table-body" class="users-table__body" role="rowgroup"></div>
                </div>
            </section>
        </div>

        <div id="admin-metrics-pane" class="admin-tab-content hidden metrics-two-col" data-admin-only="true">
            <section id="admin-metrics-content" class="admin-metrics">
                <div class="panel-header">
                    <div>
                        <h2>Business Metrics</h2>
                        <p class="panel-sub">Monitor visitors and pin performance.</p>
                    </div>
                    <div class="panel-actions">
                        <button type="button" id="metrics-refresh-btn" class="ghost-btn chip-btn">Refresh</button>
                    </div>
                </div>
                <div class="metrics-controls">
                    <div class="metrics-control">
                        <label for="metrics-granularity">Range</label>
                        <select id="metrics-granularity">
                            <option value="day" selected>Per Day</option>
                            <option value="month">Per Month</option>
                            <option value="year">Per Year</option>
                        </select>
                    </div>
                    <div class="metrics-control" id="metrics-month-wrap">
                        <label for="metrics-month">Month</label>
                        <select id="metrics-month">
                            <option value="1">January</option>
                            <option value="2">February</option>
                            <option value="3">March</option>
                            <option value="4">April</option>
                            <option value="5">May</option>
                            <option value="6">June</option>
                            <option value="7">July</option>
                            <option value="8">August</option>
                            <option value="9">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                    </div>
                    <div class="metrics-control" id="metrics-year-wrap">
                        <label for="metrics-year">Year</label>
                        <input type="number" id="metrics-year" min="2000" max="2100">
                    </div>
                    <div class="metrics-control" id="metrics-year-range-wrap">
                        <label for="metrics-start-year">Year Range</label>
                        <div class="year-range">
                            <input type="number" id="metrics-start-year" min="2000" max="2100" placeholder="Start">
                            <input type="number" id="metrics-end-year" min="2000" max="2100" placeholder="End">
                        </div>
                    </div>
                    <div class="metrics-control">
                        <button type="button" id="metrics-apply" class="chip-btn">Apply</button>
                    </div>
                </div>
                <div class="metrics-columns">
                    <div class="metrics-column">
                        <div class="metrics-card">
                            <div class="metrics-card__header">
                                <h3>Unique Visitors</h3>
                            </div>
                            <div class="metrics-chart" id="uv-chart"></div>
                        </div>
                    </div>
                    <div class="metrics-column">
                        <div class="metrics-card">
                            <div class="metrics-card__header">
                                <h3>Pageviews</h3>
                            </div>
                            <div class="metrics-chart" id="pv-chart"></div>
                        </div>
                    </div>
                    <div class="metrics-column metrics-column--lists">
                        <div class="metrics-card">
                            <div class="metrics-card__header">
                                <h3>Top Pins</h3>
                                <span class="metrics-note" id="top-pins-range"></span>
                            </div>
                            <ol id="top-pins-list" class="metrics-list"></ol>
                        </div>
                        <div class="metrics-card">
                            <div class="metrics-card__header">
                                <h3>Top Sources</h3>
                                <span class="metrics-note" id="top-sources-range"></span>
                            </div>
                            <ol id="top-sources-list" class="metrics-list"></ol>
                        </div>
                        <div class="metrics-card">
                            <div class="metrics-card__header">
                                <h3>Top Cities</h3>
                                <span class="metrics-note" id="top-cities-range"></span>
                            </div>
                            <ol id="top-cities-list" class="metrics-list"></ol>
                        </div>
                    </div>
                </div>
                <div class="metrics-heatmap">
                    <div class="metrics-card__header">
                        <h3>Visitor Heatmap</h3>
                        <span class="metrics-note" id="heatmap-range"></span>
                    </div>
                    <div id="metrics-heatmap" class="mini-map" aria-label="Heatmap pengunjung"></div>
                </div>
            </section>
            <section class="admin-embed-section">
                <div class="metrics-card__header">
                    <h3>Dashboard</h3>
                    <button type="button" id="dashboard-reload-btn" class="chip-btn">Refresh</button>
                </div>
                <div class="dashboard-frame-wrapper">
                    <iframe id="dashboard-frame" title="Business Metrics Dashboard" loading="lazy"></iframe>
                </div>
                <div id="dashboard-error" class="metrics-note"></div>
            </section>
        </div>

        <div id="admin-features-pane" class="admin-tab-content hidden" data-admin-only="true">
            <section class="admin-features">
                <div class="panel-header">
                    <div>
                        <h2>Feature Management</h2>
                        <p class="panel-sub">Enable or disable modules shown on the main page.</p>
                    </div>
                </div>
                <div id="admin-feature-message" class="admin-message" role="status" aria-live="polite"></div>
                <div class="feature-grid">
                    <div class="summary-card feature-card">
                        <div class="feature-row">
                            <div>
                                <div class="feature-title">Gerobak Online</div>
                                <div id="feature-gerobak-description" class="feature-meta">
                                    Show seller login, live map markers, and statistics.
                                </div>
                            </div>
                            <label class="maintenance-switch" aria-label="Toggle Gerobak Online feature">
                                <input type="checkbox" id="feature-gerobak-toggle" aria-describedby="feature-gerobak-description">
                                <span class="maintenance-slider"></span>
                            </label>
                        </div>
                        <div class="feature-actions">
                            <button type="button" id="feature-save-btn" class="chip-btn">Save</button>
                            <span class="feature-hint">Changes are visible on the main page within a few minutes.</span>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>
    <script src="resident-session.js"></script>
    <script src="admin.js"></script>
</body>
</html>
